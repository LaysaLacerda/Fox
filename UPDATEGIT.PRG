LOCAL lcCAMINHO, lcUSUARIO AS STRING
STORE '' TO lcCAMINHO, lcUSUARIO
LOCAL lnDECISAO AS INTEGER
STORE 0 TO lnDECISAO

lcUSUARIO = SYS(0)
lcCAMINHO = ADDBS(UPPER(ALLTRIM(FULLPATH(CURDIR()))))

IF LEFT(lcCAMINHO,3) == 'C:\'
	WAIT WIND 'APERTE ESC PARA CANCELAR O UPDATE OU APERTE QUALQUER TECLA PRA CONTINUAR' NOWAIT
	lnDECISAO = INKEY(3)
	*27 = ESC
	IF lnDECISAO == 27
		WAIT CLEAR
		DO P:\MENURAIZ.FXP
	ENDIF
	
	LOCAL			llSCAN AS Boolean
	STORE .T. TO	llSCAN

	LOCAL loLOCATOR AS 'WBEMScripting.SWBEMLocator'
	LOCAL loWS AS 'WScript.Shell'
	LOCAL loPROC
	LOCAL loWMI
	loWS		= CREATEOBJECT('WScript.Shell')

	WAIT WIND 'EXECUTANDO UPDATE-GIT NA PASTA' NOWAIT
	loWS.Run('"c:\Program Files\TortoiseGit\bin\TortoiseGitProc.exe" /command:pull /path:"'+lcCAMINHO+'" /closeonend:2')
		
	loLOCATOR	= CREATEOBJECT('WBEMScripting.SWBEMLocator')

	DO WHILE llSCAN
		loWMI		= loLOCATOR.ConnectServer()
		loWMI.Security_.ImpersonationLevel = 3
		loPROC		= loWMI.ExecQuery("SELECT * FROM WIN32_PROCESS WHERE NAME = 'TortoiseGitProc.exe'")
		
		IF EMPTY(loPROC.Count)
			llSCAN = .F.
		ENDIF
		
		RELEASE loWMI
	ENDDO
	
ENDIF
WAIT CLEAR
DO P:\MENURAIZ